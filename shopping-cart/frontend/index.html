<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="lib/awsm.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="scripts.js"></script>
    <script src="lib/vue.js"></script>
    <title>–ö–∞—Ç–∞–ª–æ–≥</title>
</head>
<body>
    <div id="app" class="content">

      <div class="menu">
        <a href="">‚Üê –Ω–∞–∑–∞–¥</a>
        <h1>Shopping Cart</h1><br>
      </div>

      <table>
        <thead>
          <tr>
            <td>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</td>
            <td>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏</td>
            <td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</td>
            <td>–°—Ç–æ–∏–º–æ—Å—Ç—å</td>
            <td></td>
          </tr>
        </thead>
        <tbody>
          <tr v-for="item in cart.items">
            <td><img class="small_preview_img" :src="item.imageURL"></td>
            <td>{{item.name}}</td>
            <td>
              <button v-on:click="itemChangeCountButtonClick(item.id, item.count-1)">-</button>
              {{item.count}}
              <button v-on:click="itemChangeCountButtonClick(item.id, item.count+1)">+</button>
            </td>
            <td>{{item.price}} ‚ÇΩ</td>
            <td><button v-on:click="itemDeleteButtonClick(item.id)">üóëÔ∏è</button></td>
          </tr>
          <tr>
            <td>
              –û–±—â–∏–π –∏—Ç–æ–≥:
            </td>
            <td>{{cart.totalPrice}} ‚ÇΩ</td>
          </tr>
        </tbody>
      </table>

    </div>
    <script type="text/javascript">
      let app = new Vue({
        el: '#app',
        data: {
          cart: {
            id: 0,
            parent: 0,
            name: "...",
            items: [
            ]
          }
        },
        methods: {
          itemDeleteButtonClick: function(itemId) {
            
              if (!confirm("Are you sure want ti remove this item?")) return;

              var item = app.cart.items.find(item => item.id === itemId);
              var index = app.cart.items.indexOf(item);
              if (index !== -1) { // remove element from array
                app.cart.items.splice(index, 1);
              }

              deleteCartItem(itemId, true);
          },
          itemChangeCountButtonClick: function(itemId, newCount) {
            
              if(newCount <= 0) { // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = 0, —Å–æ–ø–æ—Å—Ç–æ–≤–∏–º–æ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º
                this.itemDeleteButtonClick(itemId);
                return;
              }

              var item = app.cart.items.find(item => item.id === itemId);

              if(item.count > newCount) {
                deleteCartItem(itemId);
              } else if(item.count < newCount) {
                addCartItem(itemId);
              }

              item.count = newCount;
          },
        }
      });

      let id = getParam("category");
      if (id == null)
        id = 0;
        getCart().then((val) => {
        app.cart = val;
      });
    </script>
</body>
</html>